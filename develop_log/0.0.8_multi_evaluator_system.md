# 版本 0.0.8 - 多评委评分系统设计

## 功能概述

支持多个评委同时在线评分，系统汇总计算最终得分。

## 核心特性

### 1. 评委角色
- **主评委**：拥有最终调整权，可以根据大模型评分调整最终分数
- **普通评委**：独立评分，参与汇总计算

### 2. 评分流程

```
评委1（普通）提交评分 ──┐
                         ├──→ 系统自动汇总计算 ──→ 生成汇总报告
评委2（普通）提交评分 ──┤      （计算各维度均分、标准差）
                         │
评委N（主评委）提交评分 ─┘      主评委可根据大模型参考调整最终分数
```

### 3. 汇总计算逻辑

#### 各维度均分计算
```
维度均分 = (评委1分数 + 评委2分数 + ... + 评委N分数) / N
```

#### 标准差计算（评委一致性）
```
标准差 = √(Σ(分数 - 均分)² / N)
```

#### 一致性评级
- **高度一致**：标准差 < 5
- **较为一致**：标准差 5-10
- **存在分歧**：标准差 10-15
- **分歧较大**：标准差 ≥ 15

#### 总分计算
1. **原始总分**：各维度均分加权计算
2. **归一化总分**：映射到 0-100 百分比
3. **等级评定**：A+ (85+), A (80+), A- (75+), B+ (70+), B (65+), B- (60+), C+ (55+), C (50+), C- (<50)

### 4. 大模型评分作为参考
- 大模型评分单独存储，不直接参与汇总
- 主评委可以参考大模型评分进行调整
- 汇总报告中显示大模型参考分数

## 数据库表结构

### evaluation_summaries（汇总评分表）
```sql
CREATE TABLE evaluation_summaries (
    id SERIAL PRIMARY KEY,
    interview_record_id INTEGER NOT NULL UNIQUE,
    candidate_username VARCHAR(50) NOT NULL,
    raw_total_score DOUBLE PRECISION,
    normalized_total_score DOUBLE PRECISION,
    grade_level VARCHAR(10),
    evaluator_count INTEGER,
    evaluator_usernames TEXT,
    lead_evaluator_username VARCHAR(50),
    summary_comments TEXT,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

### evaluation_summary_dimensions（汇总维度分数表）
```sql
CREATE TABLE evaluation_summary_dimensions (
    id SERIAL PRIMARY KEY,
    summary_id INTEGER REFERENCES evaluation_summaries(id),
    dimension_name VARCHAR(50),
    average_score DOUBLE PRECISION,
    std_dev DOUBLE PRECISION,
    ai_score INTEGER,
    final_score INTEGER
);
```

## 核心类说明

### EvaluatorRole（评委角色）
```java
enum EvaluatorRole {
    LEAD("主评委"),
    NORMAL("普通评委")
}
```

### EvaluationSummary（汇总记录）
存储多评委汇总结果：
- 各维度均分和标准差
- 大模型参考分数
- 主评委调整后的最终分数
- 归一化总分和等级

### MultiEvaluatorService（多评委服务）
核心方法：
- `submitEvaluatorScore()`：提交评委评分
- `recalculateSummary()`：重新计算汇总
- `adjustFinalScores()`：主评委调整最终分数
- `getScoreStatistics()`：获取评分统计

## 使用方式

### 1. 普通评委提交评分
```java
multiEvaluatorService.submitEvaluatorScore(
    record, scores, comments, reasoning, EvaluatorRole.NORMAL
);
```

### 2. 主评委提交评分并调整
```java
// 先提交自己的评分
multiEvaluatorService.submitEvaluatorScore(
    record, scores, comments, reasoning, EvaluatorRole.LEAD
);

// 然后调整最终分数（参考大模型）
multiEvaluatorService.adjustFinalScores(
    recordId, finalScores, "根据大模型建议调整"
);
```

### 3. 获取汇总结果
```java
EvaluationSummary summary = multiEvaluatorService.getSummary(recordId);
```

## HTTPS 多客户端支持

系统本身基于 JavaFX 客户端，每个评委运行独立客户端：
1. 所有客户端连接到同一个 PostgreSQL 数据库
2. 通过数据库实现评分数据的共享和同步
3. 主评委的修改会实时反映在其他评委的视图中

如需 Web 版多客户端支持，可考虑：
- Spring Boot + WebSocket 实现实时同步
- RESTful API 供多个客户端调用

## 构建运行

```bash
cd interview-system
mvn clean package -s settings.xml -DskipTests
java -jar target/interview-system-1.0-SNAPSHOT.jar --db-password 1234
```

## 待完善功能

1. **实时通知**：评委提交评分后通知主评委
2. **评分冲突检测**：当评委间评分差异过大时提醒
3. **可视化对比**：评委分数对比雷达图
4. **Web 客户端**：支持浏览器访问的多评委界面
